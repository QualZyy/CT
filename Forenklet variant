#include <stdio.h>
#include <string.h>
#include <stdlib.h>

struct person {
    char name [50];
    int roomNumber;
    int infected;                //POSITIV (1) - NEGATIV (0)
};

//void printDatabase();
int appendToFile (char[100]);
int registerPerson(char[50], char[3]);

int main(){
    int exit = 0;
    while(!exit) {
        printf("\n\n\n-*-*-*-*-   CoronaTracker (CT)   -*-*-*-*-\n");
        printf("Enter corresponding number to what you want to do\n1.Register ");
        printf("new person\n2.Delete person\n3.Register infections\n4.Write to file\n5.Read from file");
        printf("\n6.Print Whole Database\n7.Who is infected?\n8.Who needs quaratine?\n9.Exit\n");

        int option;
        scanf("%i", &option);

        switch(option) {
            case 1: //Register new person
               printf("Enter name");
                char name[40];
                scanf("%s", &name);
                printf("Enter date of room nr XXX");
                char roomNr[3];
                scanf("%s", &roomNr);

                if(registerPerson(name, roomNr)) {
                    printf("Person was successfully added!");
                } else {
                    printf("An error occured");
                }
                break;

            case 2: //Delete person

                break;

            case 3: //Register contamination

                break;

            /*case 4: //Write to file
                appendToFile("Hallo");
                
                break;*/

            case 5: //Read from file

                break;

            case 6: //Print database
                 //printDatabase('s');

                break;

            case 7:  //Who is infected

                break;
            
             case 8: //Close relations

                break;
            
             case 9:
                exit = 1;
                break;
            
            case 69:
                printf("Nice");
                break;

            default:
                printf("wtf");
                break;
        }
    }
    return 0;
}

int registerPerson(char name[50], char room[3]) {
    char* s = malloc(sizeof(name) + sizeof(room));
    s = strdup(name); //Legger navnet til strengen
    strcat(s, ","); //Legger til komma
    strcat(s, room); //Legger til romnr
    strcat(s, "\n"); //Legger til newline
    printf("%s", s);
    appendToFile(s);
}

/*void printDatabase(){
    printf("Name, Infected, Roomnumber\n");
    printf("-----|---------|-----------\n");

    FILE *f;
    f = fopen("Liste.txt", "r");
    char* s;
    s = fgetc(f);
    while(s != EOF){
        printf("%c",s);
        s = fgetc(f);
    }
    fclose(f);
}*/

int appendToFile (char* s){
//Tar inn streng laget i main, ferdig oppsatt.
//Appender bare neste linje i txt fila
    FILE *f;
    printf("yo");
    f = fopen("Liste.txt", "a+");
    printf("yoyo");
    if (f == NULL) {
        printf("f e noll");
        return 0;
    }
    printf("%s", s);
    if (fprintf(f, "%s", &s)) {
        printf("yo");
        fclose(f);
        printf("yo");
        free(s);
        return 1;
    } else {
        printf("yo2");
        fclose(f);
        printf("yo2");
        free(s);
        return 0;
    }
}
